#!/bin/sh

[ -f /etc/default/telegram ] && . /etc/default/telegram

if [ -z "$TOKEN" ] ;  then
    echo "TOKEN is not set, please set it in /etc/default/telegram" >&2
    exit 1
fi

if [ -z "$CHAT_ID" ] ;  then
    echo "CHAT_ID is not set, please set it in /etc/default/telegram" >&2
    exit 1
fi

SEND_MESSAGE="https://api.telegram.org/bot$TOKEN/sendMessage"

if [ $# -lt 2 ] ; then
    echo "Usage: $0 -s <text>"
    exit 1
fi

case $1 in
    -s)
        curl -s -X POST "$SEND_MESSAGE" -d parse_mode=Markdown -d chat_id="$CHAT_ID" -d text="$2" > /dev/null 2>&1
    ;;
esac
